---
title: "stat 350 final project"
author: "GROUP 8"
date: "2020/11/24"
output: html_document
---

```{r}

library(readr)
library(MASS)
library(stringr)

data3 <- read_csv("Car details v3.csv")
dim(data3) # 8128 13
Car_details_v3 <- data3[complete.cases(data3), ]
head(Car_details_v3)
names(Car_details_v3) # "name" "year" "selling_price" "km_driven" "fuel" "seller_type" "transmission" "owner" "mileage" "engine" "max_power" "torque" "seats"  
dim(Car_details_v3) # 7906 13


petrol <- ifelse(Car_details_v3$fuel == "Petrol", 1, 0)
diesel <- ifelse(Car_details_v3$fuel == "Diesel", 1, 0)
# Other
dealer <- ifelse(Car_details_v3$seller_type == "Dealer", 1, 0)
#individual <- ifelse(Car_details_v3$seller_type == "Individual", 1, 0)
manual <- ifelse(Car_details_v3$transmission == "Manual", 1, 0)
#automatic <- ifelse(Car_details_v3$transmission == "Automatic", 1, 0)
first_owner <- ifelse(Car_details_v3$owner == "First Owner", 1, 0)
second_owner <- ifelse(Car_details_v3$owner == "Second Owner", 1, 0)
# Other


years = 2020 - Car_details_v3$year
Name = str_split_fixed(Car_details_v3$name, " ", 2)
Mileage= str_split_fixed(Car_details_v3$mileage, " ", 2)
Engine= str_split_fixed(Car_details_v3$engine, " ", 2)
Max_power= str_split_fixed(Car_details_v3$max_power, " ", 2)

sub_1 = cbind(Name,years,Mileage,Engine,Max_power)
sub_2 = sub_1[,-c(2,5,7,9)]
car <- cbind(sub_2,Car_details_v3, petrol, diesel, dealer, manual, first_owner, second_owner)

colnames(car)[which(names(car) == "V1")] <- "manufacturer"
colnames(car)[which(names(car) == "V3")] <- "Mileage"
colnames(car)[which(names(car) == "V4")] <- "Engine"
colnames(car)[which(names(car) == "V5")] <- "Max_power"
car <- subset(car, select = -c(name,year,fuel, seller_type, transmission, owner, mileage, engine, max_power))
head(car)




lm1 <- lm(selling_price ~ .  - torque - manufacturer, data = car)
summary(lm1)
anova(lm1)
plot(lm1)
vcov(lm1)
vif(lm1)
confint(lm1, level = 0.95)
robust.lm <- rlm(selling_price ~ .  - torque - manufacturer,
                  data = Car_details_v3, psi = psi.huber)
summary(robust.lm)
plot(robust.lm)
(weights <- robust.lm$w)
plot(weights, main = "Weights v.s. the Observation Number")


set.seed(1168)
nsamp = ceiling(0.8*length(car$selling_price))
training_samps = sample(c(1:length(car$selling_price)),nsamp)
training_samps = sort(training_samps)
train_data <- car[training_samps, ]
test_data <- car[-training_samps, ]
train.lm <- lm(selling_price ~ . - name - torque - manufacturer,
               data = train_data)
summary(train.lm)
preds <- predict(train.lm, test_data[,-1])
plot(test_data$selling_price, preds, xlim=c(15,40), ylim=c(15,40))
abline(c(0,1))


```



















